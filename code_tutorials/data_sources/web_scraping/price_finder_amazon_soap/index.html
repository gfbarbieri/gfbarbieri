<!doctype html><html lang=en><head><meta charset=utf-8><title>Greg Barbieri</title><link href=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css rel=stylesheet><link href=/css/custom.css rel=stylesheet><script src=https://kit.fontawesome.com/d86cd22b71.js crossorigin=anonymous></script>
<link href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.2.1.slim.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js></script>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><nav class="navbar navbar-expand-sm fixed-top"><div class=container><a class=navbar-brand href=/>Greg Barbieri</a><div class="collapse navbar-collapse"><ul class="nav navbar-nav mr-auto"></ul><ul class=navbar-nav><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown>Code Tutorials</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdown><a class=dropdown-item href=/code_topics/code_topics#math>Math</a>
<a class=dropdown-item href=/code_topics/code_topics#gis>GIS</a>
<a class=dropdown-item href=/code_topics/code_topics#data_sources>Data Sources</a></div></li></ul></div></div></nav><main class=code_tutorial><div class=container style=padding-top:100px><div class=row><div class=col-sm-12><article><header><h1>Find Prices for Olive Oil Soap on Amazon</h1></header><div class=content><p>Web scrape product prices from Amazon. In this example, I want to find the cheapest olive oil soap by price and by unit price. This example is involved and each wrangling step is not explained in detail.</p><h3 id=imports>Imports</h3><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#007020;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>pandas</span> <span style=color:#007020;font-weight:700>as</span> <span style=color:#0e84b5;font-weight:700>pd</span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>requests</span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>selenium</span> <span style=color:#007020;font-weight:700>import</span> webdriver
</span></span></code></pre></div><h3 id=amazon-text-search>Amazon Text Search</h3><p>Find the base URL of Amazon&rsquo;s text search by searching for an item on Amazon.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>base_url <span style=color:#666>=</span> <span style=color:#4070a0>&#39;https://www.amazon.com/s&#39;</span>
</span></span></code></pre></div><p>Infer from the resulting URL that <code>k</code> is the parameter the text is passed to, which I pass a parameter to the request.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>params <span style=color:#666>=</span> {<span style=color:#4070a0>&#39;k&#39;</span>:<span style=color:#4070a0>&#39;olive oil soap&#39;</span>}
</span></span></code></pre></div><p>Use the Requests library to create the URL that Selenium will open a browser to.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>url <span style=color:#666>=</span> requests<span style=color:#666>.</span>Request(<span style=color:#4070a0>&#39;GET&#39;</span>, base_url, params<span style=color:#666>=</span>params)<span style=color:#666>.</span>prepare()<span style=color:#666>.</span>url
</span></span></code></pre></div><p>Use Selenium WebDriver to open a Chrome browser to the URL for olive oil soap on Amazon.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>driver <span style=color:#666>=</span> webdriver<span style=color:#666>.</span>Chrome()
</span></span><span style=display:flex><span>driver<span style=color:#666>.</span>get(url)
</span></span></code></pre></div><p>Inspecting the Amazon page, it appears that the items for sale is stored in a container called <code>s-card-container</code>. I looping over the items in the container, I perform some edits before creating a Pandas Data Frame.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>item <span style=color:#666>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>for</span> wh <span style=color:#007020;font-weight:700>in</span> driver<span style=color:#666>.</span>find_elements_by_class_name(<span style=color:#4070a0>&#39;s-card-container&#39;</span>):
</span></span><span style=display:flex><span>    <span style=color:#60a0b0;font-style:italic># Pull the text data from the tags in the HTML class.</span>
</span></span><span style=display:flex><span>    container <span style=color:#666>=</span> wh<span style=color:#666>.</span>text<span style=color:#666>.</span>splitlines()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#60a0b0;font-style:italic># Those tags without text can be ignored.</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>if</span> <span style=color:#007020;font-weight:700>not</span> container:
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>continue</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#60a0b0;font-style:italic># If the first text is not a product name, then remove</span>
</span></span><span style=display:flex><span>    <span style=color:#60a0b0;font-style:italic># the element from the list of text.</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>if</span> <span style=color:#4070a0>&#39;Sponsored&#39;</span> <span style=color:#007020;font-weight:700>in</span> container:
</span></span><span style=display:flex><span>        container<span style=color:#666>.</span>remove(<span style=color:#4070a0>&#39;Sponsored&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>elif</span> <span style=color:#4070a0>&#34;Amazon&#39;s Choice&#34;</span> <span style=color:#007020;font-weight:700>in</span> container:
</span></span><span style=display:flex><span>        container<span style=color:#666>.</span>remove(<span style=color:#4070a0>&#34;Amazon&#39;s Choice&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#60a0b0;font-style:italic># If the third item in the list isn&#39;t the price, then remove</span>
</span></span><span style=display:flex><span>    <span style=color:#60a0b0;font-style:italic># the element from the list.</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>if</span> <span style=color:#4070a0>&#39;$&#39;</span> <span style=color:#007020;font-weight:700>not</span> <span style=color:#007020;font-weight:700>in</span> container[<span style=color:#40a070>2</span>]:
</span></span><span style=display:flex><span>        container<span style=color:#666>.</span>pop(<span style=color:#40a070>2</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#60a0b0;font-style:italic># Finally, keep only the first 4 text fields.</span>
</span></span><span style=display:flex><span>    item<span style=color:#666>.</span>append(container[:<span style=color:#40a070>4</span>])
</span></span></code></pre></div><h3 id=create-pandas-data-frame>Create Pandas Data Frame</h3><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#666>=</span> pd<span style=color:#666>.</span>DataFrame(data<span style=color:#666>=</span>item, columns<span style=color:#666>=</span>[<span style=color:#4070a0>&#39;product&#39;</span>, <span style=color:#4070a0>&#39;size&#39;</span>, <span style=color:#4070a0>&#39;price_whole&#39;</span>, <span style=color:#4070a0>&#39;price_portion&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df<span style=color:#666>.</span>head()
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>product</th><th>size</th><th>price_whole</th><th>price_portion</th></tr></thead><tbody><tr><th>0</th><td>Olive Oil Soap Bar - Handmade 100% Pure Natura...</td><td>5.7 Ounce (Pack of 5)</td><td>$14</td><td>99 ($0.53/Ounce)</td></tr><tr><th>1</th><td>Kiss My Face Antibacterial Olive Oil Bar Soap,...</td><td>8 Ounce (Pack of 1)</td><td>$4</td><td>29 ($0.54/Ounce)</td></tr><tr><th>2</th><td>Peet Bros | Olive Oil Moisturizing Bath Soap B...</td><td>23</td><td>$6</td><td>99 ($1.40/Ounce)</td></tr><tr><th>3</th><td>Castile Soap Beauty Soap With Olive Oil, 3.9 O...</td><td>3.9 Ounce (Pack of 6)</td><td>$14</td><td>07 ($0.60/Ounce)</td></tr><tr><th>4</th><td>Kiss My Face 3 Pack Pure Olive Oil Vegan Bar S...</td><td>3 Count (Pack of 1)</td><td>$5</td><td>99 ($0.50/Ounce)</td></tr></tbody></table></div><h3 id=edit-price-and-unit-data>Edit Price and Unit Data</h3><p>Create a price variable and a price per unit variable using the text data. Drop duplicate rows.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df[<span style=color:#4070a0>&#39;price&#39;</span>] <span style=color:#666>=</span> df[<span style=color:#4070a0>&#39;price_whole&#39;</span>]<span style=color:#666>.</span>str<span style=color:#666>.</span>split(<span style=color:#4070a0>&#39;$&#39;</span>)<span style=color:#666>.</span>str[<span style=color:#40a070>1</span>] <span style=color:#666>+</span> <span style=color:#4070a0>&#39;.&#39;</span> <span style=color:#666>+</span> df[<span style=color:#4070a0>&#39;price_portion&#39;</span>]<span style=color:#666>.</span>str[:<span style=color:#40a070>2</span>]
</span></span><span style=display:flex><span>df[<span style=color:#4070a0>&#39;price_per_unit&#39;</span>] <span style=color:#666>=</span> df[<span style=color:#4070a0>&#39;price_portion&#39;</span>]<span style=color:#666>.</span>str<span style=color:#666>.</span>split(<span style=color:#4070a0>&#39;$&#39;</span>)<span style=color:#666>.</span>str[<span style=color:#40a070>1</span>]<span style=color:#666>.</span>str<span style=color:#666>.</span>split(<span style=color:#4070a0>&#39;/&#39;</span>)<span style=color:#666>.</span>str[<span style=color:#40a070>0</span>]
</span></span><span style=display:flex><span>df[<span style=color:#4070a0>&#39;unit&#39;</span>] <span style=color:#666>=</span> df[<span style=color:#4070a0>&#39;price_portion&#39;</span>]<span style=color:#666>.</span>str<span style=color:#666>.</span>split(<span style=color:#4070a0>&#39;/&#39;</span>)<span style=color:#666>.</span>str[<span style=color:#40a070>1</span>]<span style=color:#666>.</span>str<span style=color:#666>.</span>split(<span style=color:#4070a0>&#39;)&#39;</span>)<span style=color:#666>.</span>str[<span style=color:#40a070>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df<span style=color:#666>.</span>drop(columns<span style=color:#666>=</span>[<span style=color:#4070a0>&#39;size&#39;</span>,<span style=color:#4070a0>&#39;price_whole&#39;</span>,<span style=color:#4070a0>&#39;price_portion&#39;</span>], inplace<span style=color:#666>=</span><span style=color:#007020;font-weight:700>True</span>)
</span></span><span style=display:flex><span>df<span style=color:#666>.</span>drop_duplicates(inplace<span style=color:#666>=</span><span style=color:#007020;font-weight:700>True</span>)
</span></span></code></pre></div><h3 id=find-cheapest-product>Find Cheapest Product</h3><p>Find cheapest item by price.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df<span style=color:#666>.</span>loc[df[<span style=color:#4070a0>&#39;price&#39;</span>]<span style=color:#666>.</span>astype(<span style=color:#4070a0>&#39;float&#39;</span>) <span style=color:#666>==</span> df[<span style=color:#4070a0>&#39;price&#39;</span>]<span style=color:#666>.</span>astype(<span style=color:#4070a0>&#39;float&#39;</span>)<span style=color:#666>.</span>min()]
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>product</th><th>price</th><th>price_per_unit</th><th>unit</th></tr></thead><tbody><tr><th>1</th><td>Kiss My Face Antibacterial Olive Oil Bar Soap,...</td><td>4.29</td><td>0.54</td><td>Ounce</td></tr></tbody></table></div><p>Find cheapest item by unit price.</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df<span style=color:#666>.</span>loc[df[<span style=color:#4070a0>&#39;price_per_unit&#39;</span>]<span style=color:#666>.</span>astype(<span style=color:#4070a0>&#39;float&#39;</span>) <span style=color:#666>==</span> df[<span style=color:#4070a0>&#39;price_per_unit&#39;</span>]<span style=color:#666>.</span>astype(<span style=color:#4070a0>&#39;float&#39;</span>)<span style=color:#666>.</span>min()]
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>product</th><th>price</th><th>price_per_unit</th><th>unit</th></tr></thead><tbody><tr><th>57</th><td>Organic Olive Oil Hand Soap - Made with Natura...</td><td>38.99</td><td>0.30</td><td>Fl Oz</td></tr></tbody></table></div><h3 id=close-browser-end-session>Close Browser, End Session</h3><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>driver<span style=color:#666>.</span>close()
</span></span><span style=display:flex><span>driver<span style=color:#666>.</span>quit()
</span></span></code></pre></div></div></article></div></div></div></main><footer class=footer><div class=container><span class=text-muted><p>Greg Barbieri &#183; 2022 &#183; <a href>License</a></p></span><div class="col-md-4 col-sm-6"></div></div></footer></body></html>