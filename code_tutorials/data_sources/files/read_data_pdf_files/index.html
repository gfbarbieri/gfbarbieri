<!doctype html><html lang=en><head><meta charset=utf-8><title>Greg Barbieri</title><link href=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css rel=stylesheet><link href=/css/custom.css rel=stylesheet><script src=https://kit.fontawesome.com/d86cd22b71.js crossorigin=anonymous></script>
<link href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.2.1.slim.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js></script>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body><nav class="navbar navbar-expand-sm fixed-top"><div class=container><a class=navbar-brand href=/>Greg Barbieri</a><div class="collapse navbar-collapse"><ul class="nav navbar-nav mr-auto"></ul><ul class=navbar-nav><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown>Code Tutorials</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdown><a class=dropdown-item href=/code_topics/code_topics#math>Math</a>
<a class=dropdown-item href=/code_topics/code_topics#gis>GIS</a>
<a class=dropdown-item href=/code_topics/code_topics#data_sources>Data Sources</a>
<a class=dropdown-item href=/code_topics/code_topics#web_scraping>Web Scraping</a></div></li></ul></div></div></nav><main class=code_tutorial><div class=container style=padding-top:100px><div class=row><div class=col-sm-12><article><header><h1>Read Data from PDF Files.</h1></header><div class=content><p>The goal is to extract state-level <a href=https://www.cdc.gov/nchs/nhis/releases.htm#wireless>telephone usage estimates</a> from a table in a PDF file. No standard way exists to extract data from a table in a PDF. Each PDF will present new data wrangling challenges.</p><h3 id=imports>Imports</h3><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#007020;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>bs4</span> <span style=color:#007020;font-weight:700>import</span> BeautifulSoup
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>pandas</span> <span style=color:#007020;font-weight:700>as</span> <span style=color:#0e84b5;font-weight:700>pd</span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>PyPDF2</span> <span style=color:#007020;font-weight:700>import</span> PdfFileReader
</span></span></code></pre></div><h3 id=wrangling-pdf-table>Wrangling PDF Table</h3><ol><li>With <code>PdffileReader</code>, extract text from the first page of the PDF.</li><li>Find the tabular data. The line breaks are not in ideal places. This part will always require lots of trial and error.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>rows <span style=color:#666>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>with</span> <span style=color:#007020>open</span>(<span style=color:#4070a0>&#34;state-level-nhis-estimates.pdf&#34;</span>, <span style=color:#4070a0>&#39;rb&#39;</span>) <span style=color:#007020;font-weight:700>as</span> f:
</span></span><span style=display:flex><span>    lines <span style=color:#666>=</span> PdfFileReader(f)<span style=color:#666>.</span>getPage(<span style=color:#40a070>0</span>)<span style=color:#666>.</span>extractText()<span style=color:#666>.</span>splitlines()
</span></span><span style=display:flex><span>    line_ranges <span style=color:#666>=</span> <span style=color:#007020>list</span>(<span style=color:#007020>range</span>(<span style=color:#40a070>59</span>,<span style=color:#007020>len</span>(lines),<span style=color:#40a070>16</span>))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>for</span> line <span style=color:#007020;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#007020>len</span>(line_ranges)):
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>if</span> line <span style=color:#666>==</span> <span style=color:#007020>len</span>(line_ranges) <span style=color:#666>-</span> <span style=color:#40a070>1</span>:
</span></span><span style=display:flex><span>            row <span style=color:#666>=</span> lines[line_ranges[line]:]
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>else</span>:
</span></span><span style=display:flex><span>            row <span style=color:#666>=</span> lines[line_ranges[line]:line_ranges[line <span style=color:#666>+</span> <span style=color:#40a070>1</span>]]
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>        <span style=color:#007020;font-weight:700>for</span> col <span style=color:#007020;font-weight:700>in</span> row:
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>if</span> col <span style=color:#666>==</span> <span style=color:#4070a0>&#39; &#39;</span>:
</span></span><span style=display:flex><span>                row<span style=color:#666>.</span>remove(col)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        rows<span style=color:#666>.</span>append(row)
</span></span></code></pre></div><h3 id=create-pandas-data-frame>Create Pandas Data Frame</h3><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>columns <span style=color:#666>=</span> [<span style=color:#4070a0>&#39;Geographic Area&#39;</span>,<span style=color:#4070a0>&#39;Wireless-only&#39;</span>,<span style=color:#4070a0>&#39;Wireless-mostly&#39;</span>,
</span></span><span style=display:flex><span>           <span style=color:#4070a0>&#39;Dual-use&#39;</span>,<span style=color:#4070a0>&#39;Landline-mostly&#39;</span>,<span style=color:#4070a0>&#39;Landline-only&#39;</span>,
</span></span><span style=display:flex><span>           <span style=color:#4070a0>&#39;No Service&#39;</span>,<span style=color:#4070a0>&#39;Total&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df <span style=color:#666>=</span> pd<span style=color:#666>.</span>DataFrame(data<span style=color:#666>=</span>rows, columns<span style=color:#666>=</span>columns)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df<span style=color:#666>.</span>head()
</span></span></code></pre></div><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}<pre><code>.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</code></pre><p></style></p><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>Geographic Area</th><th>Wireless-only</th><th>Wireless-mostly</th><th>Dual-use</th><th>Landline-mostly</th><th>Landline-only</th><th>No Service</th><th>Total</th></tr></thead><tbody><tr><th>0</th><td>A l aba m a</td><td>52. 4 ( 2. 1)</td><td>15. 1 ( 1. 5)</td><td>13. 8 ( 1. 4)</td><td>8. 8 ( 0. 8)</td><td>6. 5 ( 0. 7)</td><td>3. 3</td><td>100. 0</td></tr><tr><th>1</th><td>A l a s k a</td><td>51. 7 ( 2. 4)</td><td>22. 0 ( 2. 0)</td><td>15. 9 ( 1. 6)</td><td>4. 9 ( 0. 7)</td><td>3. 2 ( 0. 5)</td><td>2. 3</td><td>100. 0</td></tr><tr><th>2</th><td>A r i z ona</td><td>63. 2 ( 1. 8)</td><td>11. 5 ( 1. 2)</td><td>11. 2 ( 1. 1)</td><td>5. 2 ( 0. 6)</td><td>4. 8 ( 0. 5)</td><td>4. 1</td><td>100. 0</td></tr><tr><th>3</th><td>A r k ans a s</td><td>62. 8 ( 2. 2)</td><td>12. 3 ( 1. 5)</td><td>10. 0 ( 1. 3)</td><td>6. 4 ( 0. 7)</td><td>4. 2 ( 0. 6)</td><td>4. 2</td><td>100. 0</td></tr><tr><th>4</th><td>C al i f or ni a</td><td>53. 0 ( 1. 1)</td><td>18. 6 ( 0. 8)</td><td>15. 1 ( 0. 7)</td><td>6. 2 ( 0. 4)</td><td>4. 3 ( 0. 2)</td><td>2. 9</td><td>100. 0</td></tr></tbody></table></div></div></article></div></div></div></main><footer class=footer><div class=container><span class=text-muted><p>Greg Barbieri &#183; 2022 &#183; <a href>License</a></p></span><div class="col-md-4 col-sm-6"></div></div></footer></body></html>